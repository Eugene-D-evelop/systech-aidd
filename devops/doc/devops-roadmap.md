# DevOps Roadmap

MVP подход к развертыванию: от локального Docker до автоматического деплоя на сервер.

## Обзор спринтов

| Код | Описание | Статус | План |
|-----|----------|--------|------|
| **D0** | Basic Docker Setup | ✅ Done | [План](plans/d0-basic-docker-setup.md) |
| **D1** | Build & Publish | ✅ Done | [План](plans/d1-build-publish-plan.md) |
| **D2** | Manual Server Deploy | ⏳ Pending | - |
| **D3** | Auto Deploy | ⏳ Pending | - |

**Легенда статусов:**
- ⏳ Pending - не начат
- 🚧 In Progress - в работе
- ✅ Done - завершен
- ⏸️ On Hold - приостановлен

---

## Спринт D0: Basic Docker Setup

### Цели
Запустить все сервисы проекта локально через `docker-compose up` одной командой.

### Состав работ
- ✅ Создать Dockerfile для трех сервисов: Bot (Python+UV), API (FastAPI+UV), Frontend (Next.js+pnpm)
- ✅ Обновить docker-compose.yml для оркестрации 4 сервисов: PostgreSQL, Bot, API, Frontend
- ✅ Создать .dockerignore файлы для оптимизации сборки
- ✅ Настроить взаимодействие между сервисами (networking, environment variables)
- ✅ Обеспечить корректное применение миграций БД при старте
- ✅ Проверить работоспособность всего стека локально

### Результаты
**Статус:** ✅ Успешно завершено (18 октября 2025)

**Достижения:**
- Все 4 сервиса (PostgreSQL, Bot, API, Frontend) успешно запускаются одной командой
- API доступен на порту 8000 с полной документацией
- Frontend доступен на порту 3000 и корректно отображается
- Миграции БД применяются автоматически при старте
- Hot-reload работает для всех сервисов через volume mounts
- Создан детальный отчет о тестировании

**Документы:**
- [План спринта D0](plans/d0-basic-docker-setup.md)
- [Отчет о тестировании](reports/d0-testing-report.md)

---

## Спринт D1: Build & Publish

### Цели
Автоматизировать сборку и публикацию Docker образов в GitHub Container Registry при изменениях в main ветке.

### Состав работ
- ✅ Создать GitHub Actions workflow для CI/CD
- ✅ Настроить сборку трех Docker образов (bot, api, frontend)
- ✅ Публикация образов в ghcr.io с тегированием (latest + sha)
- ✅ Настроить permissions для доступа к GitHub Container Registry
- ✅ Добавить badges статуса сборки в README
- ✅ Создать документацию по настройке GitHub Registry

### Результаты
**Статус:** ✅ Успешно завершено (18 октября 2025)

**Достижения:**
- GitHub Actions workflow автоматически собирает 3 образа при push в main
- Образы публикуются в ghcr.io с public access
- Docker Compose для production использует образы из registry
- Исправлены критические проблемы с Docker COPY и .gitignore
- Все сервисы работают из опубликованных образов без ошибок

**Документы:**
- [План спринта D1](plans/d1-build-publish-plan.md)
- [GitHub Actions Guide](github-actions-guide.md)
- [Финальный отчёт](reports/d1-final-report.md)

---

## Спринт D2: Manual Server Deploy

### Цели
Развернуть приложение на удаленном сервере вручную по пошаговой инструкции.

### Состав работ
- Создать детальную пошаговую инструкцию для ручного развертывания
- Подготовить шаблон production конфигурации (.env.production)
- Настроить SSH подключение к серверу с использованием ключей
- Реализовать процесс загрузки образов из ghcr.io на сервер
- Настроить запуск сервисов через docker-compose
- Обеспечить применение миграций БД на production
- Создать скрипт проверки работоспособности развернутых сервисов

---

## Спринт D3: Auto Deploy

### Цели
Автоматизировать развертывание на сервер через GitHub Actions с возможностью ручного запуска.

### Состав работ
- Создать GitHub Actions workflow для автоматического деплоя
- Настроить workflow_dispatch триггер для ручного запуска
- Реализовать SSH подключение к серверу из GitHub Actions
- Автоматизировать процесс обновления образов и перезапуска сервисов
- Настроить GitHub Secrets для хранения SSH ключей и credentials
- Добавить уведомления о статусе деплоя
- Создать документацию по настройке auto-deploy
- Добавить кнопку Deploy в README

---

## Архитектура

### Сервисы проекта

1. **Bot** (Python + UV)
   - Telegram бот для взаимодействия с пользователями
   - Подключается к PostgreSQL для хранения данных

2. **API** (FastAPI + UV)
   - REST API для предоставления статистики и данных
   - Обслуживает запросы от Frontend

3. **Frontend** (Next.js + pnpm)
   - Веб-интерфейс для визуализации данных
   - Взаимодействует с API

4. **PostgreSQL**
   - Центральная база данных для всех сервисов

### Инфраструктура

```
┌─────────────────────────────────────────────┐
│           GitHub Repository                 │
│  ┌────────────┐      ┌─────────────┐       │
│  │   Code     │ ──▶  │   Actions   │       │
│  └────────────┘      └──────┬──────┘       │
│                             │               │
└─────────────────────────────┼───────────────┘
                              │
                      Build & Publish
                              │
                              ▼
                    ┌──────────────────┐
                    │  GitHub Registry │
                    │    (ghcr.io)     │
                    └────────┬─────────┘
                             │
                        Pull Images
                             │
                             ▼
                    ┌─────────────────┐
                    │  Remote Server  │
                    │                 │
                    │  ┌───────────┐  │
                    │  │PostgreSQL │  │
                    │  └─────┬─────┘  │
                    │        │        │
                    │  ┌─────┴─────┐  │
                    │  │    Bot    │  │
                    │  │    API    │  │
                    │  │  Frontend │  │
                    │  └───────────┘  │
                    └─────────────────┘
```

---

## Планирование и выполнение

1. **Планирование спринта** выполняется в режиме Plan Mode
2. После планирования создается файл `devops/doc/plans/{sprint-code}-{name}-plan.md`
3. Ссылка на план добавляется в таблицу спринтов выше
4. После завершения спринта статус меняется на ✅ Done

---

## Принципы разработки

- **MVP подход**: фокус на простоте и скорости реализации
- **Быстрая итерация**: небольшие спринты с конкретными целями
- **Практичность**: сначала заставить работать, потом оптимизировать
- **Документирование**: каждый шаг должен быть воспроизводим

